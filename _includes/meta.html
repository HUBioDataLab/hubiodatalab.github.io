{% assign filename = page.path | split: "/" | last %}
{% if page.name and page.name != filename %}
  {% assign title = page.name %}
{% elsif page.title %}
  {% assign title = page.title %}
{% else %}
  {% assign title = nil %}
{% endif %}

{% assign title = title | xml_escape %}

{% assign fulltitle = "" | split: "," %}
{% if title and title != "" %}
  {% assign fulltitle = fulltitle | push: title %}
{% endif %}
{% if site.title and site.title != "" %}
  {% assign fulltitle = fulltitle | push: site.title %}
{% endif %}
{% assign fulltitle = fulltitle | join: " | " %}

{% assign subtitle = site.subtitle %}

{% assign description = page.description | default: site.description %}
{% if site.subtitle %}
  {% capture description -%}
    {{ site.subtitle }}. {{ description }}
  {%- endcapture %}
{% endif %}
{% capture url -%}
  {{ site.url }}{{ site.baseurl }}
{%- endcapture %}

{% assign description = description | xml_escape %}

{%- comment -%}
  Icon selection: supports site.icon as string or {light, dark}.
  Falls back to PNG/JPG in /images, then to site.logo variants if present.
{%- endcomment -%}
{%- assign icon_light = site.icon.light | file_exists -%}
{%- assign icon_dark  = site.icon.dark  | file_exists -%}
{%- assign icon_single = nil -%}
{%- if site.icon and site.icon.light == nil and site.icon.dark == nil -%}
{%- assign icon_single = site.icon | file_exists -%}
{%- endif -%}
{%- assign png_fallback = "images/icon.png" | file_exists -%}
{%- assign jpg_fallback = "images/icon.jpg" | file_exists -%}
{%- assign logo_light = site.logo.light | file_exists -%}
{%- assign logo_dark  = site.logo.dark  | file_exists -%}
{%- assign logo_single = nil -%}
{%- if site.logo and site.logo.light == nil and site.logo.dark == nil -%}
{%- assign logo_single = site.logo | file_exists -%}
{%- endif -%}

{%- assign icon_default = icon_single | default: png_fallback | default: jpg_fallback | default: logo_single | default: logo_light | default: logo_dark -%}

{% assign jpg = "images/share.jpg" | file_exists %}
{% assign png = "images/share.png" | file_exists %}
{% assign share = jpg | default: png | relative_url %}

{% assign published = page.date | date_to_xmlschema %}
{% assign updated = page.last_modified_at | date_to_xmlschema %}

{% assign feed = "feed.xml" | absolute_url %}

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>{{ fulltitle }}</title>

{%- comment -%}
  Prefer color-scheme aware SVG icons if provided, with PNG/JPG fallback.
{%- endcomment -%}
{%- if icon_light or icon_dark -%}
  {%- if icon_light -%}
    <link rel="icon" href="{{ icon_light | relative_url | uri_escape }}" type="image/svg+xml" media="(prefers-color-scheme: light)">
  {%- endif -%}
  {%- if icon_dark -%}
    <link rel="icon" href="{{ icon_dark | relative_url | uri_escape }}" type="image/svg+xml" media="(prefers-color-scheme: dark)">
  {%- endif -%}
  {%- if png_fallback or jpg_fallback -%}
    <link rel="icon" href="{{ png_fallback | default: jpg_fallback | relative_url | uri_escape }}">
  {%- else -%}
    <link rel="icon" href="{{ icon_default | relative_url | uri_escape }}" type="image/svg+xml">
  {%- endif -%}
{%- else -%}
  <link rel="icon" href="{{ icon_default | relative_url | uri_escape }}">
{%- endif -%}

<meta name="title" content="{{ title }}">
<meta name="description" content="{{ description }}">

<meta property="og:title" content="{{ title }}">
<meta property="og:site_title" content="{{ site.title | xml_escape }}">
<meta property="og:description" content="{{ description }}">
<meta property="og:url" content="{{ url }}">
<meta property="og:image" content="{{ share }}">
<meta property="og:locale" content="en_US">

<meta property="twitter:title" content="{{ title }}">
<meta property="twitter:description" content="{{ description }}">
<meta property="twitter:url" content="{{ url }}">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="{{ share }}">

{% if page.author %}
  <meta name="author" content="{{ page.author | xml_escape }}">
  <meta property="og:type" content="article">
  <meta property="og:updated_time" content="{{ updated }}">
  <meta property="article:published_time" content="{{ published }}">
  <meta property="article:modified_time" content="{{ updated }}">
  <meta name="revised" content="{{ updated }}">
{% else %}
  <meta property="og:type" content="website">
{% endif %}

<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    {% if page.author %}
      "@type": "BlogPosting",
      "author": { "@type": "Person", "name": "{{ title }}" },
      "datePublished": "{{ published }}",
      "dateModified": "{{ updated }}",
    {% else %}
      "@type": "WebSite",
    {% endif %}
    "name": "{{ title }}",
    "description": "{{ description }}",
    "headline": "{{ title }}",
    "publisher": {
      "@type": "Organization",
      "logo": { "@type": "ImageObject", "url": "{{ (png_fallback | default: jpg_fallback | default: icon_default) | relative_url }}" }
    },
    "url": "{{ url }}"
  }
</script>

<link rel="alternate" type="application/rss+xml" href="{{ feed }}">
